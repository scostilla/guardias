<app-spinner></app-spinner>
<div class="container">
  <div class="row">
    <div class="col-6 col-md-7">
      <div class="titulos">DDJJ <span class="titulos-second">EXTRAS</span></div>
    </div>
    <div class="col-6 col-md-1 m d-flex justify-content-end">
      <button mat-fab class="button-primary" matTooltip="Volver atrás" routerLink="/guardias-view">
        <mat-icon>keyboard_arrow_left</mat-icon>
      </button>
      <button mat-fab matTooltip="Descargar excel" class="button-success" style="margin-left: 5px;" (click)="exportarAExcel()">
        <mat-icon>get_app</mat-icon>
      </button>
      <button mat-fab class="button-pase" matTooltip="Pase a DPH" style="margin-left: 5px;" routerLink="/guardias-view">
        <mat-icon>assignment_turned_in</mat-icon>
      </button>
    </div>

    <div class="col-12 col-md-4 mt-3 mt-md-0">
      <mat-form-field>
        <mat-label>Filtro</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Buscar por nombre o apellido">
        <button mat-icon-button matSuffix>
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-1">
      <div class="contenedor-bocadillo">
        <div>{{ getMonthName(selectedMonth) }}</div>
        <div>{{ selectedYear }}</div>
      </div>
    </div>
    <div class="col-md-8 d-flex justify-content-start">
      <div class="contenedor-titulo-bocadillo">
        {{selectedHospitalNombre}}
      </div>
    </div>
    <div class="col-md-3 d-flex justify-content-start">
      <div class="contenedor-subtitulo-bocadillo">
        GUARDIAS ACTIVAS
      </div>  
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 d-flex justify-content-start mt-sm-3">
      <div class="contenedor-titulo-select-tabla">
        <span class="titulo-select-tabla">Fecha:</span>
        <select class="select-tabla" [(ngModel)]="selectedMonth" (change)="updateDateAndLoadData()">
          <option *ngFor="let month of months" [value]="month.value">{{ month.name }}</option>
        </select>
        <select class="select-tabla" [(ngModel)]="selectedYear" (change)="updateDateAndLoadData()">
          <option *ngFor="let year of years" [value]="year">{{ year }}</option>
        </select>
      </div>
    </div>
  
    <div class="col-md-6 d-flex justify-content-md-end justify-content-sm-start mt-sm-3">
      <div class="contenedor-titulo-select-tabla">
        <span class="titulo-select-tabla">Servicio:</span>
        <select class="select-tabla" [(ngModel)]="selectedServicio" (change)="updateDateAndLoadData()">
          <option *ngFor="let servicio of servicios" [value]="servicio.id">{{ servicio.descripcion }}</option>
        </select>
      </div>
    </div>  
  </div>
  <div class="table-responsive">
    <table mat-table [dataSource]="dataSource" matSort #empTbSort="matSort" class="mat-elevation-z6">

      <ng-container matColumnDef="apellido" sticky>
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="negrita"> Apellido </th>
        <td mat-cell *matCellDef="let registro">{{registro.asistencial.apellido}}
        </td>
      </ng-container>

      <ng-container matColumnDef="nombre" sticky>
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="negrita"> Nombre </th>
        <td mat-cell *matCellDef="let registro">{{registro.asistencial.nombre}}</td>
      </ng-container>

      <ng-container matColumnDef="acciones" sticky>
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let registro" class="cell-actions">
          <button mat-icon-button matTooltip="Ver detalle" (click)="openDetail(registro.asistencial, selectedMonth, selectedYear)">
            <mat-icon color="primary">zoom_in</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="totalHoras">
        <th mat-header-cell *matHeaderCellDef class="negrita" style="background-color: #bdbdbd;">Total mes</th>
        <td mat-cell *matCellDef="let registro" class="linea-vertical-tabla negrita" style="background-color: #bdbdbd;">
          {{ calculateTotalHoursForRow(registro.registroActividad, selectedMonth, selectedYear) }} hs
        </td>
      </ng-container>

      <ng-container matColumnDef="weekdaysTotal">
        <th mat-header-cell *matHeaderCellDef class="linea-vertical-tabla negrita" style="background-color: #d1d0d0;">Total L-V</th>
        <td mat-cell *matCellDef="let registro" class="linea-vertical-tabla negrita" style="background-color: #d1d0d0;">
          {{ calculateWeekdaysTotal(registro.registroActividad, selectedMonth, selectedYear) }} hs
        </td>
      </ng-container>
        
      <ng-container matColumnDef="weekendsTotal">
        <th mat-header-cell *matHeaderCellDef class="linea-vertical-tabla negrita" style="background-color: #d1d0d0;">Total S-D</th>
        <td mat-cell *matCellDef="let registro" class="linea-vertical-tabla negrita" style="background-color: #d1d0d0;">
          {{ calculateWeekendsTotal(registro.registroActividad, selectedMonth, selectedYear) }} hs
        </td>
      </ng-container>

      <ng-container *ngFor="let fechaColumna of displayedColumns.slice(6)" [matColumnDef]="fechaColumna">
        <th mat-header-cell *matHeaderCellDef class="linea-vertical-tabla negrita">
          {{ getFechaFromColumnId(fechaColumna) | date: 'EEE dd' }}
        </th>
        <td mat-cell *matCellDef="let registro" class="linea-vertical-tabla negrita"
          [ngClass]="isNovedadClass(getFechaFromColumnId(fechaColumna), registro)"
          [matTooltip]="calculateTooltip(getFechaFromColumnId(fechaColumna), registro)">
          <span 
              [style.color]="calculateHoursColor(registro.registroActividad, getFechaFromColumnId(fechaColumna))"
              [innerHTML]="calculateHoursForDate(registro.registroActividad, getFechaFromColumnId(fechaColumna))">
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
  <div class="row mt-3">
    <div class="col-lg-3">  
        <span class="ref-circulo circulo--cargo"></span>&nbsp;<span class="ref ref-cargo">Cargo</span>
        <span class="ref-circulo circulo--agrupacion"></span>&nbsp;<span class="ref ref-agrupacion">Agrupación</span>
    </div>
    <div class="col-lg-9">  
      <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons></mat-paginator>
    </div>
  </div>

  <div class="row mt-3">
    <button mat-fab extended color="warn" routerLink="/ddjj-extra-tot">
      <mat-icon>assignment_turned_in</mat-icon>
      Pase a DPH
    </button>
  </div>
</div>


<!--<div class="tabla-center">
    <div class="row" style="margin-bottom: 10px;">
        <div class="col">
          <button mat-fab extended color="primary" routerLink="/guardias-view">
            <mat-icon>arrow_back_ios</mat-icon>
            Volver
          </button>
        </div>
    </div>
    <div class="row">
        <div class="titulos"> DDJJ <span class="titulos-second">EXTRAS</span>
      </div>
  
    <div class="row mt-3">
      <div class="col-sm scroll">
          <table class="table table-sm table-borderless">
                <thead  class="col-center thead-celeste">
                    <tr>
                        <th class="titulo-tabla">DECLARACION JURADA GUARDIAS ACTIVAS EXTRAS</th>
                    </tr>
                    <tr>
                        <th >Julio 2023</th>
                    </tr>
                    <tr>
                        <th>MINISTERIO DE SALUD</th>
                    </tr>
                    <tr>
                        <th>"DN. PABLO SORIA"</th>
                    </tr>
                    <tr>
                        <th>REGION: CENTRO</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="16">
                            <table class="table table-hover table-bordered table-sm caption-top">
                                <thead class="thead-gris">
                                  <tr>
                                    <th rowspan="3">N° ORDEN</th>
                                    <th rowspan="3">SERVICIO</th>
                                    <th rowspan="3">APELLIDO Y NOMBRE</th>
                                    <th rowspan="3">CUIL</th>
                                    <th rowspan="3">VINCULO LABORAL - UDO</th>
                                    <th rowspan="3">CATEGORIA</th>
                                    <th rowspan="3">NOVEDADES</th>
                                    <th colspan="31">GUARDIAS ACTIVAS</th>
                                  </tr>
                                  <tr>
                                    <td style="background-color: #9e9ea1;">Sa</td>
                                    <td style="background-color: #9e9ea1;">Do</td>
                                    <td>Lu</td>
                                    <td>Ma</td>
                                    <td>Mi</td>
                                    <td>Ju</td>
                                    <td>Vi</td>
                                    <td style="background-color: #9e9ea1;">Sa</td>
                                    <td style="background-color: #9e9ea1;">Do</td>
                                    <td>Lu</td>
                                    <td>Ma</td>
                                    <td>Mi</td>
                                    <td>Ju</td>
                                    <td>Vi</td>
                                    <td style="background-color: #9e9ea1;">Sa</td>
                                    <td style="background-color: #9e9ea1;">Do</td>
                                    <td>Lu</td>
                                    <td>Ma</td>
                                    <td>Mi</td>
                                    <td>Ju</td>
                                    <td>Vi</td>
                                    <td style="background-color: #9e9ea1;">Sa</td>
                                    <td style="background-color: #9e9ea1;">Do</td>
                                    <td>Lu</td>
                                    <td>Ma</td>
                                    <td>Mi</td>
                                    <td>Ju</td>
                                    <td>Vi</td>
                                    <td style="background-color: #9e9ea1;">Sa</td>
                                    <td style="background-color: #9e9ea1;">Do</td>
                                    <td>Lu</td>
                                  </tr>
                                  <tr>
                                    <td style="background-color: #9e9ea1;">1</td>
                                    <td style="background-color: #9e9ea1;">2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>7</td>
                                    <td style="background-color: #9e9ea1;">8</td>
                                    <td style="background-color: #df7545;">9</td>
                                    <td>10</td>
                                    <td>11</td>
                                    <td>12</td>
                                    <td>13</td>
                                    <td>14</td>
                                    <td style="background-color: #9e9ea1;">15</td>
                                    <td style="background-color: #9e9ea1;">16</td>
                                    <td>17</td>
                                    <td>18</td>
                                    <td>19</td>
                                    <td>20</td>
                                    <td>21</td>
                                    <td style="background-color: #9e9ea1;">22</td>
                                    <td style="background-color: #9e9ea1;">23</td>
                                    <td>24</td>
                                    <td>25</td>
                                    <td>26</td>
                                    <td>27</td>
                                    <td>28</td>
                                    <td style="background-color: #9e9ea1;">29</td>
                                    <td style="background-color: #9e9ea1;">30</td>
                                    <td>31</td>
                                  </tr>
                                                    </thead>
                                <tbody>
                                  <tr>
                                    <td>1</td>
                                    <td>Terapia</td>
                                    <td>APAZA, JUAN FERNANDO</td>
                                    <td>20-27324976-2</td>
                                    <td>Planta Permanente</td>
                                    <td>A(J-2)</td>
                                    <td>-</td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>24</td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #df7545;"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>24</td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>24</td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>24</td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>                                  </tr>
                                  <tr>
                                    <td>2</td>
                                    <td>Ginecología</td>
                                    <td>BUSTOS, RITA MARIA</td>
                                    <td>27-24324954-1</td>
                                    <td>Planta Permanente</td>
                                    <td>24 HS.</td>
                                    <td>-</td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td>24</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #df7545;"></td>
                                    <td>24</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td>24</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td>24</td>
                                  </tr>
                                  <tr>
                                    <td>3</td>
                                    <td>Clínica</td>
                                    <td>SAINZ, ADRIANA  ELENA</td>
                                    <td>27-18405994-6</td>
                                    <td>Planta Permanente</td>
                                    <td>B(J-2)</td>
                                    <td>-</td>
                                    <td style="background-color: #9e9ea1;">24</td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td style="background-color: #9e9ea1;">24</td>
                                    <td style="background-color: #df7545;"></td>
                                    <td></td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td style="background-color: #9e9ea1;">24</td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td style="background-color: #9e9ea1;">24</td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td style="background-color: #9e9ea1;">24</td>
                                    <td style="background-color: #9e9ea1;"></td>
                                    <td></td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>OBSERV.:</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="row">
  <div class="col offset-1">
    <span class="ref-circulo circulo--finde-tabla"></span>&nbsp;<span class="ref ref-calendar-dia--finde-tabla">Fin de semana</span>
    <span class="ref-circulo circulo--feriado"></span>&nbsp;<span class="ref ref-calendar-dia--feriado">Asueto/Feriado</span>
</div>
<div class="col-auto">
  <button mat-fab extended color="basic" [matMenuTriggerFor]="menu2" ml-5>
    <mat-icon>get_app</mat-icon>
    Descargar
  </button>
  <mat-menu #menu2="matMenu">
    <button mat-menu-item>PDF</button>
    <button mat-menu-item>XLS</button>
  </mat-menu>
    <button mat-fab extended color="warn" routerLink="/ddjj-extra-tot">
    <mat-icon>assignment_turned_in</mat-icon>
    Pase a DPH
  </button>
</div>
<div class="col-1">
</div>
</div>
</div> -->